version: v2beta1
name: go-simple
deployments:
  backend:
    kubectl:
      inlineManifest: |-
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: go-simple
        spec:
          selector:
            matchLabels:
              app.kubernetes.io/name: busybox
          replicas: 1
          template:
            metadata:
              labels:
                app.kubernetes.io/name: busybox
            spec:
              containers:
              - name: busybox
                image: docker.io/busybox:1.28
                env:
                  - name: OTEL_EXPORTER_OTLP_PROTOCOL
                    value: "grpc"
                  - name: OTEL_EXPORTER_OTLP_ENDPOINT
                    value: "http://otel-collector.opentelemetry.svc.cluster.local:4317"
                args:
                - sleep
                - "1000000"
                ports:
                  - name: main
                    containerPort: 8021
                    protocol: TCP
dev:
  backend:
    imageSelector: docker.io/busybox:1.28
    devImage: docker.io/golang:1.25
    workingDir: /app
    sync:
      - path: .:/app
        startContainer: true
        onUpload:
          restartContainer: true
    command:
      - bash
      - -c
      - |
        go mod download
        go run .
    ports:
      - port: "8021"