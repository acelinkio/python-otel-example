version: v2beta1
name: simple
deployments:
  backend:
    kubectl:
      inlineManifest: |-
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: simple
        spec:
          selector:
            matchLabels:
              app.kubernetes.io/name: busybox
          replicas: 1
          template:
            metadata:
              labels:
                app.kubernetes.io/name: busybox
            spec:
              containers:
              - name: busybox
                image: docker.io/busybox:1.28
                env:
                  - name: OTEL_EXPORTER_OTLP_PROTOCOL
                    value: "http/protobuf"
                  - name: OTEL_EXPORTER_OTLP_ENDPOINT
                    value: "http://otel-collector.opentelemetry.svc.cluster.local:4318"
                args:
                - sleep
                - "1000000"
dev:
  backend:
    imageSelector: docker.io/busybox:1.28
    devImage: docker.io/astral/uv:python3.13-trixie
    workingDir: /app
    sync:
      - path: .:/app
        excludePaths:
          - __pycache__
          - .venv
        startContainer: true
        onUpload:
          restartContainer: true
    command:
      - bash
      - -c
      - |
        echo "Running uv sync..."
        uv sync --locked || (echo 'uv sync failed' && exit 1)
        echo "Starting..."
        uv run main.py
    ports:
      - port: "4389"